<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>

    <!-- Bootstrap CSS File -->
    <link th:href="@{/lib/bootstrap/css/bootstrap.min.css}" rel="stylesheet">

    <!-- Libraries CSS Files -->
    <link th:href="@{/lib/font-awesome/css/font-awesome.min.css}" rel="stylesheet">
    <link th:href="@{/lib/animate/animate.min.css}" rel="stylesheet">
    <link th:href="@{/lib/ionicons/css/ionicons.min.css}" rel="stylesheet">
    <link th:href="@{/lib/owlcarousel/assets/owl.carousel.min.css}" rel="stylesheet">
    <link th:href="@{/lib/lightbox/css/lightbox.min.css}" rel="stylesheet">

    <!-- Main Stylesheet File -->
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <title>User Page</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/home.css}"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script th:src="@{https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js}"></script>
    <script th:src="@{https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js}"></script>
</head>

<body>

<!--==========================
   Header
 ============================-->
<header id="header">
    <div class="container-fluid">

        <div id="logo" class="pull-left">
            <!-- <img src="img/trlogo.png" style="color: white;"> -->
            <!-- <h1><a href="#intro" class="scrollto">BizPage</a></h1> -->
            <!-- Uncomment below if you prefer to use an image logo -->
            <!-- <a href="#intro"><img src="img/logo.png" alt="" title="" /></a>-->
        </div>

        <nav id="nav-menu-container">
            <ul class="nav-menu">
                <li class="menu-active"><a th:href="@{/user/home}">Home</a></li>
                <li class="menu-active"><a href="#about">About Us</a></li>
                <!-- <li><a href="#services">Services</a></li> -->
                <!-- <li><a href="#portfolio">Portfolio</a></li> -->
                <li class="menu-active"><a th:href="@{/user/postload}">PostLoad</a></li>
                <!-- <li class="menu-has-children"><a href="">Drop Down</a> -->
                <!-- <ul>
                  <li><a href="#">Drop Down 1</a></li>
                  <li><a href="#">Drop Down 3</a></li>
                  <li><a href="#">Drop Down 4</a></li>
                  <li><a href="#">Drop Down 5</a></li>
                </ul>
              </li> -->
                <li class="menu-active" ><a th:href="@{/user/logout}">Logout</a></li>
            </ul>
        </nav><!-- #nav-menu-container -->
    </div>
</header><!-- #header -->

<br>
    <br>

    <div class="panel-group" style="margin-top:40px">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <span th:utext="${customerName}"></span>
            </div>

        </div>
    </div>
    <br>

<div class="panel-group" style="margin-top:40px">
    <div class="panel panel-primary">
        <div class="panel-heading">
           <h3> List Of Orders </h3>
        </div>

    </div>
</div>
    <div>
        <tr th:each="order: ${orders}">

            <div class="card" style="margin:10%">
                <div th:if="${order.getPacker()!=null}">
                    <p><a th:href="@{'javascript:myFunction(\''+${order.getPacker().getId()}+'\',\''+${order.getId()} + '\')'}">please add review</a></p>
                </div>


                <div class="card-body">
                    <h5 class="card-title" th:utext="${'<b>shifting Date  :</b>'+ order.getDateofshifting()}"> </h5>
                    <div class="form-row">
                        <div class="form-group col-md-3">
                            <h6><b>Loading Address</b></h6>

                            <p th:text="${'floor no  '+ order.getLoading_floorno()+' ,'+order.getLoading_location()+' ,'+
                                             order.getLoading_city()}"></p>

                            <a th:href="@{'/user/order/'+${order.getId()}}" class="btn btn-primary">Complete Details</a>

                        </div>
                        <div class="form-group col-md-3">
                            <h6><b>Unloading Address</b></h6>

                            <p th:text="${'floor no '+ order.getUnloading_floorno()+' ,'+order.getUnloading_location()+'  ,'+
                                             order.getUnloading_city()}"></p>
                            <a th:href="@{'/user/quotes/'+${order.getId()}}" class="btn btn-primary">Quotes</a>

                        </div>


                    </div>

                    <p class="card-text"></p>
                </div>
            </div>

        </tr>

    </div>
<div id="modal-wrapper" class="modal">

    <form class="modal-content animate" th:id="newQuoteForm" th:action="@{'/user/order/review/'}">

        <div class="imgcontainer">
            <span onclick="document.getElementById('modal-wrapper').style.display='none'" class="close" title="Close PopUp">&times;</span>
            <img src="1.png" alt="Avatar" class="avatar">
            <h1 style="text-align:center">Quote Box</h1>
        </div>

        <div class="container">


            <div class="form-group" id="rating">

                <label>
                    <input type="radio" name="stars" value="1" />
                    <span class="icon">★</span>
                </label>
                <label>
                    <input type="radio" name="stars" value="2" />
                    <span class="icon">★</span>
                    <span class="icon">★</span>
                </label>
                <label>
                    <input type="radio" name="stars" value="3" />
                    <span class="icon">★</span>
                    <span class="icon">★</span>
                    <span class="icon">★</span>
                </label>
                <label>
                    <input type="radio" name="stars" value="4" />
                    <span class="icon">★</span>
                    <span class="icon">★</span>
                    <span class="icon">★</span>
                    <span class="icon">★</span>
                </label>
                <label>
                    <input type="radio" name="stars" value="5" />
                    <span class="icon">★</span>
                    <span class="icon">★</span>
                    <span class="icon">★</span>
                    <span class="icon">★</span>
                    <span class="icon">★</span>
                </label>
            </div>


            <div class="form-group">
                <div class="col-sm-9">
                    <label for="review"> Add Review</label>
                    <input type="text" id="review" th:field="${review.review}" placeholder="Review "
                           class="form-control"/> <label
                        th:if="${#fields.hasErrors('review.review')}" th:errors="${review.review}"
                        class="validation-message"></label>
                </div>
            </div>



            <button type="submit">Submit Quote</button>
            <div th:id="sPhoneFromResponse"></div>
        </div>

    </form>

</div>
<script  src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
<script>


    var packer_id,order_id;
    function myFunction(packerid,orderid) {
        if( confirm("Only if Shifting is Done ?")){
                packer_id=packerid;
                order_id=orderid;
            document.getElementById('modal-wrapper').style.display='block'
        }
    }




    $(document).ready(function() {
        var rating;

        $(':radio').change(function() {
            console.log('New star rating: ' + this.value);
            rating=this.value;
        });

        $('#newQuoteForm').submit(function(event) {


            // var rating = $('#rating').val();
            var review= $('#review').val();


            var json = { "rating" : rating, "review" : review,"packer":packer_id,"order":order_id};

            console.log(json);
            var ur=$("#newQuoteForm").attr( "action");
            $.ajax({

                       url:ur,
                       data: JSON.stringify(json),
                       type: "POST",

                       beforeSend: function(xhr) {
                           xhr.setRequestHeader("Accept", "application/json");
                           xhr.setRequestHeader("Content-Type", "application/json");
                       },
                       success: function(quote) {
                           var respContent = "";


                           if(!review){


                               respContent += "<span class='success'>Sorry try Again</span>";
                           }


                           else {
                               respContent += "<span class='success'>Review was created: [";

                               respContent += "]</span>";
                           }
                           $("#sPhoneFromResponse").html(respContent);
                       },
                error:function (response) {
                    var respContent = "";
                    respContent += "<span class='success'>Fill proper Details</span>";
                    $("#sPhoneFromResponse").html(respContent);
                }


                   });


            event.preventDefault();
        });

    });
</script>


</body>

</html>